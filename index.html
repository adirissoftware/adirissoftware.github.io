<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    
    <script>
      // --- COMPONENTE PERSONALIZADO PARA ROTAR ---
      // Registramos un nuevo componente llamado 'drag-rotate-component'
      AFRAME.registerComponent('drag-rotate-component', {
        schema: { speed: { default: 2 } }, // Velocidad de rotación ajustable
        init: function () {
          this.ifMouseDown = false;
          this.x_cord = 0;
          // Escuchamos eventos de ratón (PC) y táctiles (Móvil)
          document.addEventListener('mousedown', this.OnMouseDown.bind(this));
          document.addEventListener('mouseup', this.OnMouseUp.bind(this));
          document.addEventListener('mousemove', this.OnMouseMove.bind(this));
          document.addEventListener('touchstart', this.OnMouseDown.bind(this), {passive: false});
          document.addEventListener('touchend', this.OnMouseUp.bind(this), {passive: false});
          document.addEventListener('touchmove', this.OnMouseMove.bind(this), {passive: false});
        },
        OnMouseDown: function (event) {
          this.ifMouseDown = true;
          // Obtenemos la posición X inicial del toque o clic
          this.x_cord = event.clientX || event.touches[0].clientX;
        },
        OnMouseUp: function () {
          this.ifMouseDown = false;
        },
        OnMouseMove: function (event) {
          if (this.ifMouseDown) {
            // Calculamos cuánto se ha movido el dedo horizontalmente
            var current_x = event.clientX || event.touches[0].clientX;
            var diff_x = current_x - this.x_cord;
            
            // Aplicamos la rotación en el eje Y (vertical) del objeto 3D
            // Multiplicamos por 0.005 para suavizar el movimiento
            this.el.object3D.rotation.y += diff_x * 0.005 * this.data.speed;
            
            // Actualizamos la posición X para el siguiente frame
            this.x_cord = current_x;
          }
        }
      });
    </script>

    <style>
        #ui-overlay { position: absolute; bottom: 20px; width: 100%; text-align: center; z-index: 10; color: white; font-family: sans-serif; pointer-events: none; text-shadow: 1px 1px 2px black;}
    </style>
</head>

<body>
    <div id="ui-overlay">Apunta al cuadro. Arrastra el dedo para rotar la estatua.</div>

    <a-scene 
        mindar-image="imageTargetSrc: ./tu_cuadro.mind;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
        
        <a-assets>
            <a-asset-item id="estatua-modelo" src="https://cdn.glitch.global/2a3af8bb-e7b2-4e4a-878a-328da53d2737/bust_demo.glb?v=1645723296064"></a-asset-item>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            
            <a-entity 
                gltf-model="#estatua-modelo" 
                scale="0.5 0.5 0.5" 
                position="0 -0.5 0.5"
                rotation="0 0 0"
                drag-rotate-component="speed: 3">
            </a-entity>
            
             <a-plane color="#000" opacity="0.3" position="0 0 0" height="1.5" width="1"></a-plane>

        </a-entity>
    </a-scene>
</body>
</html>