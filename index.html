<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="./libs/aframe.min.js"></script>
    <script src="./libs/mindar-image-aframe.prod.js"></script>
    
    <script>
        // REGISTRAMOS EL COMPONENTE ANTES DE LA ESCENA
        AFRAME.registerComponent('interactivo', {
            schema: {
                titulo: {type: 'string'},
                mensaje: {type: 'string'}
            },
            init: function () {
                // Escuchamos el evento 'click' directamente en el objeto 3D
                this.el.addEventListener('click', () => {
                    console.log("Clic detectado en: " + this.data.titulo);
                    // Llamamos a la función global para mostrar la tarjeta
                    window.showInfo(this.data.titulo, this.data.mensaje);
                });
                
                // Feedback visual opcional: Cambia de escala al tocar (para saber que funcionó)
                this.el.addEventListener('mousedown', () => {
                    this.el.setAttribute('scale', '0.8 0.8 0.8');
                });
                this.el.addEventListener('mouseup', () => {
                    this.el.setAttribute('scale', '1 1 1');
                });
            }
        });
    </script>

    <style>
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1a1a1a; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 1000;
            color: white; font-family: sans-serif; transition: opacity 0.5s;
        }
        #loading-overlay.hidden { display: none; }

        #info-card {
            position: fixed; bottom: -200px; left: 50%; transform: translateX(-50%);
            width: 80%; background: white; padding: 20px; border-radius: 15px 15px 0 0;
            transition: bottom 0.4s; z-index: 999; font-family: sans-serif;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
        }
        #info-card.active { bottom: 0; }
        .close-btn { float: right; color: red; cursor: pointer; font-weight: bold; }
    </style>
</head>

<body>
    <div id="loading-overlay">
        <h2>Cargando Museo AR...</h2>
    </div>

    <div id="info-card">
        <span class="close-btn" onclick="closeInfo()">CERRAR</span>
        <h3 id="info-title"></h3>
        <p id="info-text"></p>
    </div>

    <a-scene 
        mindar-image="imageTargetSrc: ./tu_cuadro.mind;" 
        embedded
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
        
        <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="objects: .clickable"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            
            <a-circle 
                class="clickable"
                interactivo="titulo: El Rostro; mensaje: Detalle pintado en 1890 con técnica de óleo sobre lienzo."
                position="-0.2 0.2 0.1" 
                radius="0.08" 
                color="#FFD700">
            </a-circle>

            <a-circle 
                class="clickable"
                interactivo="titulo: El Paisaje; mensaje: Las colinas representan el atardecer en la campiña italiana."
                position="0.3 -0.2 0.1" 
                radius="0.08" 
                color="#00FFCC">
            </a-circle>

        </a-entity>
    </a-scene>

    <script>
        const card = document.getElementById('info-card');
        const title = document.getElementById('info-title');
        const text = document.getElementById('info-text');

        // Función global
        window.showInfo = function(t, m) {
            title.innerText = t;
            text.innerText = m;
            card.classList.add('active');
        };

        function closeInfo() {
            card.classList.remove('active');
        }

        document.querySelector('a-scene').addEventListener("arReady", () => {
            document.getElementById('loading-overlay').classList.add('hidden');
        });
    </script>
</body>
</html>